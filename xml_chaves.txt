select

	MDF.Chave_Acesso as 'CHAVE'

from Movimento_Documentos_Fiscais MDF

left join Movimento M on M.Ordem = MDF.Ordem_Movimento
left join Filiais F on F.Ordem = M.Ordem_Filial
left join Operacoes O on O.Ordem = M.Ordem_Operacao

where

	CONVERT(varchar(5),MDF.Data_Emissao, 11) = convert(varchar(5),DATEADD(MONTH,-1,GETDATE()),11) and -- Data da competï¿½ncia
	MDF.Modelo in('55','65') and -- 55 NFe ou 65 NFCe
	MDF.Codigo_Status in(100, 150) and -- 100 e 150 Autorizado ou 302 Denegado
	MDF.Documento_Cancelado in(0) -- 0 Autorizados ou 1 Canceladas
	and O.Entrada_Saida in('E', 'S')

order by MDF.Chave_Acesso
